# garland_house

## Суть проекта

Проект делался для комании "Дом Гирлянд". Его цель - автоматизировать создание сметы и коммерческих предложений, расчет цен, расчет комплектующих (шурупы, гайки) по различным типам гирлянд и конструктивных особенностей схем, без необходимости считать их вручную.
Также включена возможность загрузки визуализаций - созданной в фотошопах примеров реализации заказа, фотографий с объекта после его украшения, и видео. Также есть галерея. Предусмотрена возможность загрузки различных документов (Word, Excel, PDF и др.). Есть удобный чат для коммуникации между сотрудниками

## Главная польза

Раньше менеджмент и сотрудники компании проделывали большую работу по организации заказа. Замерщик, выезжая на объект, должен был не просто определить метраж, необходимые комплектующие, и посчитать их запас (т.к. объект может быть очень далеко от складов), но и учесть все необходимые "мелкие комплектующие" - шурупы, гайки, клеммы, удлинители, тройники, стяжки и т.п. Теперь все это делается автоматически и генерируется смета для склада. Каждый заказ - полная его сводка, с галереей, чатом, отчетами, необходимой информацией. Заказчик был очень доволен алгоритмом автоматического расчета комплектующих.

Фронтенд использует IndexedDB для всех своих операций и расчетов, включая алгоритмы и медиа. Запросы делаются только по мере необходимости. Поэтому, при перезагрузке страницы, и даже если закрыть браузер без сохранения, при повторном входе все автоматически синхронизируется с сервером. То есть это полное автоматическое сохранение (например, как в Visual Studio Code). При перезагрузке страницы данные ввода во все поля не потеряются, т к всегда сохраняются в IndexedDB.

## Оффлайн режим

Оффлайн режим подразумевает, что при отсутствии связи замерщик сможет заполнить весь заказ, воспользоваться встроенным алгоритмом расчета всех необходимых комплектующих и создать смету. При появлении сети, приложение автоматически синхронизируется с сервером, и добавит заказ в общий пул.

Это реализовано с помощью IndexedDB. В оффлайн режиме все заказы хранятся там, а потом автоматически синхронизируются.
В оффлайн режиме невозможно просмотреть или загрузить медиа-файлы. В этом у компании нет необходимости, а с нашей стороны это лишняя логика и фичи.

Для работы оффлайн-режима приложение нужно скачать как PWA. Использовал next-pwa для преобразования в PWA.

## Стек

Я занимаю должность фронтенд-разработчика в этом проекте. Использовал Next.js, для запросов TanStack Query и Axios, IndexedDB для оффлайн работы.

Стейт-менеджер - MobX

Для работы с видео - Video.js. Для оптимизации фотографий - встроенный функционал Next.js.

Для генераций смет и коммерческого предложения - PDF-LIB

Другие библиотеки: date-fns, react-calendar, react-modal

Для организации структуры проекта использовался Feature-Sliced Design

## Работа с медиа

На все операции с медиа повешаны удобные лоадеры. При загрузке файлов на странице "Отчет" высвечиваются иконки типов файлов, которые определяются автоматически по расширению

Учитывается соотношения сторон медиа, то есть любая фотография успешно сожмется или растянется. При добавлении фото в раздел "Визуализация", можно их увидеть, скачав КП. При клике на любую фотографию она открыватся в полноэкранном режиме. Для этого активно использовал библиотеку react-modal

## Как запускать

1. Запустите docker compose up -d --build

2. Для создания заказа необходимо указать менеджера и исполнителя. Для этого они должны быть в базе данных. Выполните два запроса по таким Curl (токены авторизации для этих запросов не требуются)

```
// для менеджера
curl -X 'POST' \
  'http://localhost:8080/Auth/Register' \
  -H 'accept: */*' \
  -H 'Content-Type: application/json-patch+json' \
  -d '{
  "fio": "Менеджер 3",
  "email": "m3@yandex.ru",
  "password": "12345678",
  "role": "Manager"
}'
```

```
// Для исполнителя
curl -X 'POST' \
  'http://localhost:8080/Auth/Register' \
  -H 'accept: */*' \
  -H 'Content-Type: application/json-patch+json' \
  -d '{
  "fio": "Исполнитель 3",
  "email": "e3@yandex.ru",
  "password": "12345678",
  "role": "Executor"
}'
```

3. Перейдите на localhost:3000

4. Зайдите под аккаунтом aleksandrpopov_2003@mail.ru, пароль - 12345678

**Пожалуйста, используйте Google Chrome для просмотра.** Я не знаю почему, но в Яндексе лоадеры, появляющиеся при загрузке медиа файлов, работают неправильно. Сейчас пытаюсь в этом разобраться

## Что посмотреть

В целом, UI довольно понятный. Создайте заказ, загрузите фотографии во "Все объекты", файлы (а также фото и видео) в отчет, загрузите в галерею. Создайте что-нибудь в заказе, загрузите фотографии в "Визуализации" и попробуйте скачать Коммерческое предложение и смету. Оставьте комментарии. Дата выбирается с помощью удобного календаря. Скачайте приложение, и воспользуйтесь в оффлайн режиме

Генерация сметы осуществляется в файле generateRFP (fsd/features/OrderActions/lib/generateRFP.ts). Алгоритм для каждой сущности (Бахрома, Гибкий неон, Белт-лайт и т.п.) расположен по пути fsd/entities/_Entity name_/lib/rfpAlgs. Со сметой абсолютно та же логика и струкутра, и файлы находятся по тем же путям.

Замечание: чтобы успешно авторизоватся в оффлайн режиме, авторизуйтесь заранее в онлайне. После успешной авторизации программа сохраняет в Local Storage время последней авторизации, и можно авторизовыватся в режиме оффлайн в течение 1 дня

В оффлайн режиме не видно никах удаленных заказов. Видны только те, которые были созданы в оффлайн режиме, и хранятся в IndexDB до тех пор, пока не произойдет синхронизация.

**Адаптив** Заказчик использует приложение следующим образом - замерщики выезжают на объект с планшетами. Весь остальной персонал использует компьютеры. Поэтому мы решили не тратить время на адаптив под телефоны - его нет.
